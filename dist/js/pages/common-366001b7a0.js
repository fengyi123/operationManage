!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t():"function"==typeof define&&define.amd?define(t):t()}(this,function(){"use strict";var e=function(){return window.localStorage?JSON.parse(window.localStorage["menu-list"]||"{}"):{}},t=function(e){e||(e=window.location.href);for(var t=[],n=void 0,r=window.location.href.slice(e.indexOf("?")+1).split("&"),i=0;i<r.length;i++)n=r[i].split("="),t.push(n[0]),t[n[0]]=n[1];return t},n=function(e,t,n,r){laytpl($(e).html()).render(n,function(e){$(t).html(e),"function"==typeof r&&r(e)})},r=function(e){var t=!1;for(var n in e)t=!0;return t};window.dateFormat=function(e,t){if(void 0==e||""==e)return"";var n="",r=new Date(1e3*parseInt(e)),i=r.getDate()<10?"0"+r.getDate():r.getDate(),a=r.getMonth()+1<10?"0"+(r.getMonth()+1):r.getMonth()+1,o=r.getFullYear(),u=r.getHours()<10?"0"+r.getHours():r.getHours(),s=r.getMinutes()<10?"0"+r.getMinutes():r.getMinutes(),l=r.getSeconds()<10?"0"+r.getSeconds():r.getSeconds();switch(t){case"MM/dd/YYYY HH:mm:ss":n=o+"/"+a+"/"+i+" "+u+":"+s+":"+l}return n},Array.prototype.remove=function(){for(var e,t,n=arguments,r=n.length;r&&this.length;)for(e=n[--r];(t=this.indexOf(e))!==-1;)this.splice(t,1);return this};var i={msg:function(e){if("string"==typeof e)return layer.msg(e,{time:1500});var t={content:"hello！",icon:1,time:5e3,shade:[.5,"#000"]};return Object.assign(t,e),layer.msg(t.content,t)},loading:function(e){var t={content:"正在加载...",shade:[.4,"#000"],icon:16,time:0};return Object.assign(t,e),layer.msg(t.content,t)},tips:function(e){var t=[{content:"hello",direction:"top",selector:e.selector,bgColor:"#000"}],n=t[0],r=t[1];switch(Object.assign(n,e),n.direction){case"top":r=1;break;case"left":r=4;break;case"right":r=2;break;case"down":r=3}return layer.tips(n.content,n.selector,{tips:[r,n.bgColor]})},confirm:function(e,t,n){var r={content:"hello....",okBtnLabel:"确定",cancelBtnLabel:"取消",icon:1};Object.assign(r,e);var i=layer.confirm(r.content,{btn:[r.okBtnLabel,r.cancelBtnLabel]},function(){"function"==typeof t&&t(i)},function(){"function"==typeof n&&n(i)})},prompt:function(e,t,n){var r={title:"prompt 标题信息",formType:0,okBtnLabel:"确定",cancelBtnLabel:"取消"};Object.assign(r,e),layer.prompt(r,function(e,n,r){"function"==typeof t&&t(e,n,r)},function(e){"cancel"==typeof n&&t(e)})},open:function(e){var t={type:1,title:!1,closeBtn:0,shadeClose:!0,skin:"yourclass",content:"自定义HTML内容"};return Object.assign(t,e),layer.open(t)},close:function(e){layer.close(e)},closeAll:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";layer.closeAll(e)}},a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=function(){function e(){o(this,e),this.menuData=[]}return u(e,[{key:"sideMenuToggleBind",value:function(){$(".js_menu_wrap").on("click",".js_menu_item",function(e){$(e.target).hasClass("sub-menu-name")||($(this).addClass("open-menu").siblings().removeClass("open-menu"),$(this).siblings().find(".menu-name .toggle-icon").removeClass("glyphicon-menu-down"),$(this).find(".menu-name .toggle-icon").toggleClass("glyphicon-menu-down"))}),$(".js_menu_wrap").on("click",".js_menu_item .menu-name",function(){$(".js_menu_item .menu-name").next().stop().slideUp("fast"),$(this).next().stop().toggle("fast")}),$(".js_menu_wrap").on("click",".js_sub_menu_wrap .sub-menu-item",function(){$(".js_sub_menu_wrap .sub-menu-item").removeClass("active"),$(this).addClass("active").siblings().removeClass("active")})}},{key:"navMenuToggleBind",value:function(){var e=this;$(".js_nav_menu_toggle").on("click",function(){e.toggle()})}},{key:"autoToggle",value:function(){function e(){new Date-t<r?setTimeout(e,r):(n=!1,$(window).width()<=1200?($(".js_nav_menu_toggle").removeClass("leave-toggle").addClass("enter-toggle"),$("#side_menu").animate({width:"0px",minWidth:"0"},150),$("#side_menu").removeClass("leave-toggle").addClass("enter-toggle")):($(".js_nav_menu_toggle").removeClass("enter-toggle").addClass("leave-toggle"),$("#side_menu").animate({width:"220px",minWidth:"220px"},150),$("#side_menu").removeClass("enter-toggle").addClass("leave-toggle")))}var t="",n=!1,r=200;$(window).resize(function(){t=new Date,n===!1&&(n=!0,setTimeout(e,r))})}},{key:"toggle",value:function(){$("#side_menu").hasClass("enter-toggle")?($(".js_nav_menu_toggle").removeClass("enter-toggle").addClass("leave-toggle"),$("#side_menu").animate({width:"220px",minWidth:"220px"},300),$("#side_menu").removeClass("enter-toggle").addClass("leave-toggle")):($(".js_nav_menu_toggle").removeClass("leave-toggle").addClass("enter-toggle"),$("#side_menu").animate({width:"0px",minWidth:"0"},300),$("#side_menu").removeClass("leave-toggle").addClass("enter-toggle"))}},{key:"autoToggleSideMenu",value:function(e){var t=[!1],n=t[0],r=t[1];t[2];e.menuData.some(function(t,i){if(t._child.some(function(t,a){if(e.currentMenu===t.menu_act)return n=!0,r=i,!0}),n)return $(".js_menu_item").removeClass("open-menu"),$(".js_menu_item").eq(r).siblings().find(".js_sub_menu_wrap").hide(),$(".js_menu_item").eq(r).addClass("open-menu").find(".js_sub_menu_wrap").show(),$(".js_menu_item").eq(r).find(".toggle-icon").addClass("glyphicon-menu-down"),$(".js_menu_item").eq(r).siblings().find(".toggle-icon").removeClass("glyphicon-menu-down"),!0})}},{key:"renderMenu",value:function(e){var t={menuData:e,currentMenu:(new l).getCacheView()},r=this;this.menuData=e,this.cacheMenu(e),n("#sideMenuTpl","#js_menu_wrap",t,function(e){r.autoToggleSideMenu(t)})}},{key:"cacheMenu",value:function(e){function t(e){if(e instanceof Array){var t={};return e.forEach(function(e,n){e._child.forEach(function(e,n){t[e.menu_act]=e})}),t}}window.localStorage&&(localStorage["menu-list"]=JSON.stringify(t(e)))}},{key:"init",value:function(){this.sideMenuToggleBind(),this.navMenuToggleBind(),this.autoToggle()}}]),e}(),l=function(){function n(){o(this,n),this.clearView(),this.initView="listConfig",this.routerConfig=e()}return u(n,[{key:"loadTemplate",value:function(e,t){var n=this;return e=e||this.getCacheView()||this.initView,new Promise(function(r,a){if(n.routerConfig[e]){var o=[n.routerConfig[e].template_url,n],u=o[0],s=o[1];$(".js_view_content").load(u,function(n){s.changeUrl(e,t),s.setCacheView(e),s.viewAnimate(),r(n)})}else i.msg({content:"模板页面未找到，请检查重新配置!",icon:5})})}},{key:"bindRouter",value:function(e){var t=this;$(document).on("click",".js_view_link",function(){$(this).data("view")!=t.getCacheView()&&$(this).data("view")&&(t.go($(this).data("view")),"function"==typeof e&&e($(this).data("view")))})}},{key:"go",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.loadTemplate(e,t)}},{key:"init",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.loadTemplate(e,t)}},{key:"changeUrl",value:function(e,t){var n="",i="",a=location.hash.indexOf("?");a>0&&(i=location.hash.substr(location.hash.indexOf("?"))),t===!1||(t&&r(t)?(n=a>0?"&"+$.param(t):"?"+$.param(t),window.location.href="#"+e+i+n):window.location.href="#"+e)}},{key:"setCacheView",value:function(e){window.localStorage&&(localStorage["active-view"]=e)}},{key:"setRouterParamCache",value:function(e){window.localStorage&&"object"===("undefined"==typeof e?"undefined":a(e))&&(localStorage["param-data"]=JSON.stringify(e))}},{key:"routerParam",value:function(e){var n=t();return e?n[e]:n}},{key:"clearView",value:function(){"/index.html"!=window.location.pathname&&"/"!=window.location.pathname||""!=window.location.hash||localStorage.removeItem("active-view")}},{key:"getCacheView",value:function(){return window.localStorage?localStorage["active-view"]||this.initView:this.initView}},{key:"currentView",value:function(){return this.getCacheView()}},{key:"viewAnimate",value:function(){var e=$(".js_view_content > section");0!=e.length&&e.addClass("view-animated")}}]),n}(),c=function(){function e(t){o(this,e),this.serverUrl="http://servermaster.com/index.php/api/"}return u(e,[{key:"ajax",value:function(e,t){return new Promise(function(n,r){$.ajax({type:e,url:t.url,dataType:"json",data:t.data,timeout:t.timeout||1e4,async:t.async||!0,statusCode:{404:function(e){r(404)}},success:function(e){e.success?n(e):void 0!=e.url&&""!=e.url?location.href=e.url:(r(404),i.msg({content:e.msg,icon:6}))},error:function(e){r(404)}})})}},{key:"getAjax",value:function(e){return this.ajax("get",e)}},{key:"postAjax",value:function(e){return this.ajax("post",e)}},{key:"login",value:function(){return this.getAjax({url:this.serverUrl+"site/info"})}},{key:"loginOut",value:function(){return this.getAjax({url:this.serverUrl+"site/logout"})}},{key:"menuServi",value:function(){var e=this;return{menuList:function(){return e.getAjax({url:e.serverUrl+"menu/list"})},menuAdd:function(t){return e.postAjax({url:e.serverUrl+"menu/add",data:t})},menuAddCsrf:function(t){return e.getAjax({url:e.serverUrl+"menu/add",data:t})},configList:function(){return e.getAjax({url:e.serverUrl+"config/list"})},masterList:function(){return e.getAjax({url:e.serverUrl+"mysql-master/list"})},masterOperateList:function(){return e.getAjax({url:e.serverUrl+"mysql-master-operate/list"})}}}},{key:"configServi",value:function(){var e=this;return{configAdd:function(t){return e.postAjax({url:e.serverUrl+"config/add",data:t})},configAddCsrf:function(t){return e.getAjax({url:e.serverUrl+"config/add",data:t})},modelAdd:function(t){return e.postAjax({url:e.serverUrl+"mode/add",data:t})},modelAddCsrf:function(t){return e.getAjax({url:e.serverUrl+"mode/add",data:t})},modelList:function(t){return e.getAjax({url:e.serverUrl+"mode/list",data:t})},serviceAdd:function(t){return e.postAjax({url:e.serverUrl+"service/add",data:t})},servceAddCsrf:function(t){return e.getAjax({url:e.serverUrl+"service/add",data:t})},serviceList:function(){return e.getAjax({url:e.serverUrl+"service/list"})},applicationAddCsrf:function(t){return e.getAjax({url:e.serverUrl+"application/add",data:t})},applicationAdd:function(t){return e.postAjax({url:e.serverUrl+"application/add",data:t})},applicationList:function(t){return e.getAjax({url:e.serverUrl+"application/list",data:t})},ipBindCsrf:function(t){return e.getAjax({url:e.serverUrl+"config/bind",data:t})},ipBind:function(t){return e.postAjax({url:e.serverUrl+"config/bind",data:t})},masterAdd:function(t){return e.postAjax({url:e.serverUrl+"mysql-master/add",data:t})},masterAddCsrf:function(t){return e.getAjax({url:e.serverUrl+"mysql-master/add",data:t})},changeMaster:function(t){return e.postAjax({url:e.serverUrl+"mysql-master/change",data:t})},changeMasterResult:function(t){return e.getAjax({url:e.serverUrl+"mysql-master/get-result",data:t})}}}},{key:"websiteServi",value:function(){var e=this;return{websiteAdd:function(t){return e.postAjax({url:e.serverUrl+"website/add",data:t})},websiteAddCsrf:function(t){return e.getAjax({url:e.serverUrl+"website/add",data:t})},websiteList:function(t){return e.getAjax({url:e.serverUrl+"website/list",data:t})}}}},{key:"departmentServi",value:function(){var e=this;return{departmentList:function(){return e.postAjax({url:e.serverUrl+"department/list"})},departmentCsrf:function(t){return e.getAjax({url:e.serverUrl+"department/add",data:t})},departmentAdd:function(t){return e.postAjax({url:e.serverUrl+"department/add",data:t})}}}},{key:"adminServi",value:function(){var e=this;return{adminList:function(){return e.getAjax({url:e.serverUrl+"admin/list"})},adminCsrf:function(t){return e.getAjax({url:e.serverUrl+"admin/add",data:t})},adminAdd:function(t){return e.postAjax({url:e.serverUrl+"admin/add",data:t})}}}},{key:"logServi",value:function(){var e=this;return{logList:function(t){return e.getAjax({url:e.serverUrl+"log/list",data:t})}}}}]),e}(),d=function(){function e(){o(this,e),this.services=new c}return u(e,[{key:"logout",value:function(){var e=this;i.confirm({content:"您将退出该管理系统?"},function(t){e.services.loginOut().then(function(e){window.location.href=e.url}),i.close(t)})}},{key:"loginCheck",value:function(){var e=this;return new Promise(function(t,n){e.services.login().then(function(e){t(e)},function(e){n(e)})})}}]),e}();$(document).ready(function(){!function(){var e={},t=navigator.userAgent.toLowerCase(),n=void 0;if((n=t.match(/rv:([\d.]+)\) like gecko/))?e.ie=n[1]:(n=t.match(/msie ([\d.]+)/))?e.ie=n[1]:(n=t.match(/firefox\/([\d.]+)/))?e.firefox=n[1]:(n=t.match(/chrome\/([\d.]+)/))?e.chrome=n[1]:(n=t.match(/opera.([\d.]+)/))?e.opera=n[1]:(n=t.match(/version\/([\d.]+).*safari/))?e.safari=n[1]:0,e.ie)return void layer.alert("抱歉,该管理系统暂不支持IE 浏览器或低版本浏览器,请使用较新版的Chrome或火狐浏览器打开",{icon:5})}();var e=new d,t=new s;e.loginCheck().then(function(e){$(".js_user_name").html("你好: "+e.data.admin_info.username+"【"+e.data.admin_info.real_name+"】"),t.renderMenu(e.data.menu);var n=n=new l;n.bindRouter(function(e){var n={menuData:t.menuData,currentMenu:e};t.autoToggleSideMenu(n)}),t.init(),n.init().then(function(e){})}),$(".js_login_out").on("click",function(){e.logout()}),$(".js_go_top").on("click",function(){$(".js_view_content").animate({scrollTop:"0px"},350)})})});