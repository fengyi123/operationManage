!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t():"function"==typeof define&&define.amd?define(t):t()}(this,function(){"use strict";var e=function(){return window.localStorage?JSON.parse(window.localStorage["menu-list"]||"{}"):{}},t=function(e,t){t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var n=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)"),r=n.exec(t);return r?r[2]?decodeURIComponent(r[2]):"":null},n=function(e){e||(e=window.location.href);for(var t=[],n=void 0,r=window.location.href.slice(e.indexOf("?")+1).split("&"),a=0;a<r.length;a++)n=r[a].split("="),t.push(n[0]),t[n[0]]=n[1];return t},r=function(e,t,n,r){laytpl($(e).html()).render(n,function(e){$(t).html(e),"function"==typeof r&&r(e)})},a=function(e){for(var t={},n=0;n<e.length;n++)t[e[n].name]=e[n].value;return t},i=function(e){var t=!1;for(var n in e)t=!0;return t},o=function(e,t){$(e).validator("update").on("submit",function(e){e.isDefaultPrevented()?console.log(0):(e.preventDefault(),"function"==typeof t&&t($(this)))})},s=function(e,t){var n={locale:"zh-cn",disabledDates:[],format:"YYYY-MM-DD HH:mm:ss"};Object.assign(n,t),$(e).datetimepicker(n)};window.dateFormat=function(e,t){if(void 0==e||""==e)return"";var n="",r=new Date(1e3*parseInt(e)),a=r.getDate()<10?"0"+r.getDate():r.getDate(),i=r.getMonth()+1<10?"0"+(r.getMonth()+1):r.getMonth()+1,o=r.getFullYear(),s=r.getHours()<10?"0"+r.getHours():r.getHours(),u=r.getMinutes()<10?"0"+r.getMinutes():r.getMinutes(),l=r.getSeconds()<10?"0"+r.getSeconds():r.getSeconds();switch(t){case"MM/dd/YYYY HH:mm:ss":n=o+"/"+i+"/"+a+" "+s+":"+u+":"+l}return n},Array.prototype.remove=function(){for(var e,t,n=arguments,r=n.length;r&&this.length;)for(e=n[--r];(t=this.indexOf(e))!==-1;)this.splice(t,1);return this};var u={msg:function(e){if("string"==typeof e)return layer.msg(e,{time:1500});var t={content:"hello！",icon:1,time:5e3,shade:[.5,"#000"]};return Object.assign(t,e),layer.msg(t.content,t)},loading:function(e){var t={content:"正在加载...",shade:[.4,"#000"],icon:16,time:0};return Object.assign(t,e),layer.msg(t.content,t)},tips:function(e){var t=[{content:"hello",direction:"top",selector:e.selector,bgColor:"#000"}],n=t[0],r=t[1];switch(Object.assign(n,e),n.direction){case"top":r=1;break;case"left":r=4;break;case"right":r=2;break;case"down":r=3}return layer.tips(n.content,n.selector,{tips:[r,n.bgColor]})},confirm:function(e,t,n){var r={content:"hello....",okBtnLabel:"确定",cancelBtnLabel:"取消",icon:1};Object.assign(r,e);var a=layer.confirm(r.content,{btn:[r.okBtnLabel,r.cancelBtnLabel]},function(){"function"==typeof t&&t(a)},function(){"function"==typeof n&&n(a)})},prompt:function(e,t,n){var r={title:"prompt 标题信息",formType:0,okBtnLabel:"确定",cancelBtnLabel:"取消"};Object.assign(r,e),layer.prompt(r,function(e,n,r){"function"==typeof t&&t(e,n,r)},function(e){"cancel"==typeof n&&t(e)})},open:function(e){var t={type:1,title:!1,closeBtn:0,shadeClose:!0,skin:"yourclass",content:"自定义HTML内容"};return Object.assign(t,e),layer.open(t)},close:function(e){layer.close(e)},closeAll:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";layer.closeAll(e)}},l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},d=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),f=(function(){function e(){c(this,e),this.menuData=[]}return d(e,[{key:"sideMenuToggleBind",value:function(){$(".js_menu_wrap").on("click",".js_menu_item",function(e){$(e.target).hasClass("sub-menu-name")||($(this).addClass("open-menu").siblings().removeClass("open-menu"),$(this).siblings().find(".menu-name .toggle-icon").removeClass("glyphicon-menu-down"),$(this).find(".menu-name .toggle-icon").toggleClass("glyphicon-menu-down"))}),$(".js_menu_wrap").on("click",".js_menu_item .menu-name",function(){$(".js_menu_item .menu-name").next().stop().slideUp("fast"),$(this).next().stop().toggle("fast")}),$(".js_menu_wrap").on("click",".js_sub_menu_wrap .sub-menu-item",function(){$(".js_sub_menu_wrap .sub-menu-item").removeClass("active"),$(this).addClass("active").siblings().removeClass("active")})}},{key:"navMenuToggleBind",value:function(){var e=this;$(".js_nav_menu_toggle").on("click",function(){e.toggle()})}},{key:"autoToggle",value:function(){function e(){new Date-t<r?setTimeout(e,r):(n=!1,$(window).width()<=1200?($(".js_nav_menu_toggle").removeClass("leave-toggle").addClass("enter-toggle"),$("#side_menu").animate({width:"0px",minWidth:"0"},150),$("#side_menu").removeClass("leave-toggle").addClass("enter-toggle")):($(".js_nav_menu_toggle").removeClass("enter-toggle").addClass("leave-toggle"),$("#side_menu").animate({width:"220px",minWidth:"220px"},150),$("#side_menu").removeClass("enter-toggle").addClass("leave-toggle")))}var t="",n=!1,r=200;$(window).resize(function(){t=new Date,n===!1&&(n=!0,setTimeout(e,r))})}},{key:"toggle",value:function(){$("#side_menu").hasClass("enter-toggle")?($(".js_nav_menu_toggle").removeClass("enter-toggle").addClass("leave-toggle"),$("#side_menu").animate({width:"220px",minWidth:"220px"},300),$("#side_menu").removeClass("enter-toggle").addClass("leave-toggle")):($(".js_nav_menu_toggle").removeClass("leave-toggle").addClass("enter-toggle"),$("#side_menu").animate({width:"0px",minWidth:"0"},300),$("#side_menu").removeClass("leave-toggle").addClass("enter-toggle"))}},{key:"autoToggleSideMenu",value:function(e){var t=[!1],n=t[0],r=t[1];t[2];e.menuData.some(function(t,a){if(t._child.some(function(t,i){if(e.currentMenu===t.menu_act)return n=!0,r=a,!0}),n)return $(".js_menu_item").removeClass("open-menu"),$(".js_menu_item").eq(r).siblings().find(".js_sub_menu_wrap").hide(),$(".js_menu_item").eq(r).addClass("open-menu").find(".js_sub_menu_wrap").show(),$(".js_menu_item").eq(r).find(".toggle-icon").addClass("glyphicon-menu-down"),$(".js_menu_item").eq(r).siblings().find(".toggle-icon").removeClass("glyphicon-menu-down"),!0})}},{key:"renderMenu",value:function(e){var t={menuData:e,currentMenu:(new f).getCacheView()},n=this;this.menuData=e,this.cacheMenu(e),r("#sideMenuTpl","#js_menu_wrap",t,function(e){n.autoToggleSideMenu(t)})}},{key:"cacheMenu",value:function(e){function t(e){if(e instanceof Array){var t={};return e.forEach(function(e,n){e._child.forEach(function(e,n){t[e.menu_act]=e})}),t}}window.localStorage&&(localStorage["menu-list"]=JSON.stringify(t(e)))}},{key:"init",value:function(){this.sideMenuToggleBind(),this.navMenuToggleBind(),this.autoToggle()}}]),e}(),function(){function t(){c(this,t),this.clearView(),this.initView="listConfig",this.routerConfig=e()}return d(t,[{key:"loadTemplate",value:function(e,t){var n=this;return e=e||this.getCacheView()||this.initView,new Promise(function(r,a){if(n.routerConfig[e]){var i=[n.routerConfig[e].template_url,n],o=i[0],s=i[1];$(".js_view_content").load(o,function(n){s.changeUrl(e,t),s.setCacheView(e),s.viewAnimate(),r(n)})}else u.msg({content:"模板页面未找到，请检查重新配置!",icon:5})})}},{key:"bindRouter",value:function(e){var t=this;$(document).on("click",".js_view_link",function(){$(this).data("view")!=t.getCacheView()&&$(this).data("view")&&(t.go($(this).data("view")),"function"==typeof e&&e($(this).data("view")))})}},{key:"go",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.loadTemplate(e,t)}},{key:"init",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.loadTemplate(e,t)}},{key:"changeUrl",value:function(e,t){var n="",r="",a=location.hash.indexOf("?");a>0&&(r=location.hash.substr(location.hash.indexOf("?"))),t===!1||(t&&i(t)?(n=a>0?"&"+$.param(t):"?"+$.param(t),window.location.href="#"+e+r+n):window.location.href="#"+e)}},{key:"setCacheView",value:function(e){window.localStorage&&(localStorage["active-view"]=e)}},{key:"setRouterParamCache",value:function(e){window.localStorage&&"object"===("undefined"==typeof e?"undefined":l(e))&&(localStorage["param-data"]=JSON.stringify(e))}},{key:"routerParam",value:function(e){var t=n();return e?t[e]:t}},{key:"clearView",value:function(){"/index.html"!=window.location.pathname&&"/"!=window.location.pathname||""!=window.location.hash||localStorage.removeItem("active-view")}},{key:"getCacheView",value:function(){return window.localStorage?localStorage["active-view"]||this.initView:this.initView}},{key:"currentView",value:function(){return this.getCacheView()}},{key:"viewAnimate",value:function(){var e=$(".js_view_content > section");0!=e.length&&e.addClass("view-animated")}}]),t}()),g=function(){function e(t){c(this,e),this.serverUrl="http://servermaster.com/index.php/api/"}return d(e,[{key:"ajax",value:function(e,t){return new Promise(function(n,r){$.ajax({type:e,url:t.url,dataType:"json",data:t.data,timeout:t.timeout||1e4,async:t.async||!0,statusCode:{404:function(e){r(404)}},success:function(e){e.success?n(e):void 0!=e.url&&""!=e.url?location.href=e.url:(r(404),u.msg({content:e.msg,icon:6}))},error:function(e){r(404)}})})}},{key:"getAjax",value:function(e){return this.ajax("get",e)}},{key:"postAjax",value:function(e){return this.ajax("post",e)}},{key:"login",value:function(){return this.getAjax({url:this.serverUrl+"site/info"})}},{key:"loginOut",value:function(){return this.getAjax({url:this.serverUrl+"site/logout"})}},{key:"menuServi",value:function(){var e=this;return{menuList:function(){return e.getAjax({url:e.serverUrl+"menu/list"})},menuAdd:function(t){return e.postAjax({url:e.serverUrl+"menu/add",data:t})},menuAddCsrf:function(t){return e.getAjax({url:e.serverUrl+"menu/add",data:t})},configList:function(){return e.getAjax({url:e.serverUrl+"config/list"})},masterList:function(){return e.getAjax({url:e.serverUrl+"mysql-master/list"})},masterOperateList:function(){return e.getAjax({url:e.serverUrl+"mysql-master-operate/list"})}}}},{key:"configServi",value:function(){var e=this;return{configAdd:function(t){return e.postAjax({url:e.serverUrl+"config/add",data:t})},configAddCsrf:function(t){return e.getAjax({url:e.serverUrl+"config/add",data:t})},modelAdd:function(t){return e.postAjax({url:e.serverUrl+"mode/add",data:t})},modelAddCsrf:function(t){return e.getAjax({url:e.serverUrl+"mode/add",data:t})},modelList:function(t){return e.getAjax({url:e.serverUrl+"mode/list",data:t})},serviceAdd:function(t){return e.postAjax({url:e.serverUrl+"service/add",data:t})},servceAddCsrf:function(t){return e.getAjax({url:e.serverUrl+"service/add",data:t})},serviceList:function(){return e.getAjax({url:e.serverUrl+"service/list"})},applicationAddCsrf:function(t){return e.getAjax({url:e.serverUrl+"application/add",data:t})},applicationAdd:function(t){return e.postAjax({url:e.serverUrl+"application/add",data:t})},applicationList:function(t){return e.getAjax({url:e.serverUrl+"application/list",data:t})},ipBindCsrf:function(t){return e.getAjax({url:e.serverUrl+"config/bind",data:t})},ipBind:function(t){return e.postAjax({url:e.serverUrl+"config/bind",data:t})},masterAdd:function(t){return e.postAjax({url:e.serverUrl+"mysql-master/add",data:t})},masterAddCsrf:function(t){return e.getAjax({url:e.serverUrl+"mysql-master/add",data:t})},changeMaster:function(t){return e.postAjax({url:e.serverUrl+"mysql-master/change",data:t})},changeMasterResult:function(t){return e.getAjax({url:e.serverUrl+"mysql-master/get-result",data:t})}}}},{key:"websiteServi",value:function(){var e=this;return{websiteAdd:function(t){return e.postAjax({url:e.serverUrl+"website/add",data:t})},websiteAddCsrf:function(t){return e.getAjax({url:e.serverUrl+"website/add",data:t})},websiteList:function(t){return e.getAjax({url:e.serverUrl+"website/list",data:t})}}}},{key:"departmentServi",value:function(){var e=this;return{departmentList:function(){return e.postAjax({url:e.serverUrl+"department/list"})},departmentCsrf:function(t){return e.getAjax({url:e.serverUrl+"department/add",data:t})},departmentAdd:function(t){return e.postAjax({url:e.serverUrl+"department/add",data:t})}}}},{key:"adminServi",value:function(){var e=this;return{adminList:function(){return e.getAjax({url:e.serverUrl+"admin/list"})},adminCsrf:function(t){return e.getAjax({url:e.serverUrl+"admin/add",data:t})},adminAdd:function(t){return e.postAjax({url:e.serverUrl+"admin/add",data:t})}}}},{key:"logServi",value:function(){var e=this;return{logList:function(t){return e.getAjax({url:e.serverUrl+"log/list",data:t})}}}}]),e}(),m={viewManage:new f,services:new g,renderLog:function(e,t){var n=u.loading({content:"正在加载..."}),a=this;this.services.logServi().logList(e).then(function(i){u.close(n),0==i.data.list.length&&(u.msg("暂无日志数据..."),$("#listLogTbody").html("")),$("#page_sections").bootpag({total:0==parseInt(i.data.pages.totalPage)?1:parseInt(i.data.pages.totalPage),maxVisible:6,leaps:!0,page:i.data.pages.curPage}).off("page").on("page",function(t,n){Object.assign(e,{page:n}),a.renderLog(e)}),r("#listLogTpl","#listLogTbody",i.data.list),"function"==typeof t&&t(i)}).catch(function(e){u.close(n)})}};$(function(){var e=m.viewManage.currentView();if(e.match(/logList/gi)){s("#start_time"),s("#end_time");var n=t("table"),r={table:n};m.renderLog(r,function(e){}),o("#js_log_search_form",function(e){var t=a(e.serializeArray());Object.assign(t,r),m.renderLog(t)})}})});