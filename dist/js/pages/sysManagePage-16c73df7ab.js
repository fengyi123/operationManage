!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t():"function"==typeof define&&define.amd?define(t):t()}(this,function(){"use strict";var e=function(){return window.localStorage?JSON.parse(window.localStorage["menu-list"]||"{}"):{}},t=function(e){e||(e=window.location.href);for(var t=[],n=void 0,i=window.location.href.slice(e.indexOf("?")+1).split("&"),a=0;a<i.length;a++)n=i[a].split("="),t.push(n[0]),t[n[0]]=n[1];return t},n=function(e,t,n,i){laytpl($(e).html()).render(n,function(e){$(t).html(e),"function"==typeof i&&i(e)})},i=function(e){for(var t={},n=0;n<e.length;n++)t[e[n].name]=e[n].value;return t},a=function(e){var t=[];return $(e+" input:checked").each(function(e){t.push($(this).val())}),t},r=function(e,t){$(e).val(t)},o=function(e){var t=!1;for(var n in e)t=!0;return t},s=function(e,t,n,i,a){var r="";t.forEach(function(e,t){i!==!1&&n!==!1||(n=t,i=t),r+=a==e[n]?'<option selected value="'+e[n]+'">'+e[i]+"</option>":'<option value="'+e[n]+'">'+e[i]+"</option>"}),$(e).html(r)},u=function(e,t){$(e).validator("update").on("submit",function(e){e.isDefaultPrevented()?console.log(0):(e.preventDefault(),"function"==typeof t&&t($(this)))})},d=function(e,t){if(e instanceof Array){var n={};return e.forEach(function(e,i){n[e[t]]=e}),n}};window.dateFormat=function(e,t){if(void 0==e||""==e)return"";var n="",i=new Date(1e3*parseInt(e)),a=i.getDate()<10?"0"+i.getDate():i.getDate(),r=i.getMonth()+1<10?"0"+(i.getMonth()+1):i.getMonth()+1,o=i.getFullYear(),s=i.getHours()<10?"0"+i.getHours():i.getHours(),u=i.getMinutes()<10?"0"+i.getMinutes():i.getMinutes(),d=i.getSeconds()<10?"0"+i.getSeconds():i.getSeconds();switch(t){case"MM/dd/YYYY HH:mm:ss":n=o+"/"+r+"/"+a+" "+s+":"+u+":"+d}return n},Array.prototype.remove=function(){for(var e,t,n=arguments,i=n.length;i&&this.length;)for(e=n[--i];(t=this.indexOf(e))!==-1;)this.splice(t,1);return this};var c={msg:function(e){if("string"==typeof e)return layer.msg(e,{time:1500});var t={content:"hello！",icon:1,time:5e3,shade:[.5,"#000"]};return Object.assign(t,e),layer.msg(t.content,t)},loading:function(e){var t={content:"正在加载...",shade:[.4,"#000"],icon:16,time:0};return Object.assign(t,e),layer.msg(t.content,t)},tips:function(e){var t=[{content:"hello",direction:"top",selector:e.selector,bgColor:"#000"}],n=t[0],i=t[1];switch(Object.assign(n,e),n.direction){case"top":i=1;break;case"left":i=4;break;case"right":i=2;break;case"down":i=3}return layer.tips(n.content,n.selector,{tips:[i,n.bgColor]})},confirm:function(e,t,n){var i={content:"hello....",okBtnLabel:"确定",cancelBtnLabel:"取消",icon:1};Object.assign(i,e);var a=layer.confirm(i.content,{btn:[i.okBtnLabel,i.cancelBtnLabel]},function(){"function"==typeof t&&t(a)},function(){"function"==typeof n&&n(a)})},prompt:function(e,t,n){var i={title:"prompt 标题信息",formType:0,okBtnLabel:"确定",cancelBtnLabel:"取消"};Object.assign(i,e),layer.prompt(i,function(e,n,i){"function"==typeof t&&t(e,n,i)},function(e){"cancel"==typeof n&&t(e)})},open:function(e){var t={type:1,title:!1,closeBtn:0,shadeClose:!0,skin:"yourclass",content:"自定义HTML内容"};return Object.assign(t,e),layer.open(t)},close:function(e){layer.close(e)},closeAll:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";layer.closeAll(e)}},l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},m=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},f=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),v=(function(){function e(){m(this,e),this.menuData=[]}return f(e,[{key:"sideMenuToggleBind",value:function(){$(".js_menu_wrap").on("click",".js_menu_item",function(e){$(e.target).hasClass("sub-menu-name")||($(this).addClass("open-menu").siblings().removeClass("open-menu"),$(this).siblings().find(".menu-name .toggle-icon").removeClass("glyphicon-menu-down"),$(this).find(".menu-name .toggle-icon").toggleClass("glyphicon-menu-down"))}),$(".js_menu_wrap").on("click",".js_menu_item .menu-name",function(){$(".js_menu_item .menu-name").next().stop().slideUp("fast"),$(this).next().stop().toggle("fast")}),$(".js_menu_wrap").on("click",".js_sub_menu_wrap .sub-menu-item",function(){$(".js_sub_menu_wrap .sub-menu-item").removeClass("active"),$(this).addClass("active").siblings().removeClass("active")})}},{key:"navMenuToggleBind",value:function(){var e=this;$(".js_nav_menu_toggle").on("click",function(){e.toggle()})}},{key:"autoToggle",value:function(){function e(){new Date-t<i?setTimeout(e,i):(n=!1,$(window).width()<=1200?($(".js_nav_menu_toggle").removeClass("leave-toggle").addClass("enter-toggle"),$("#side_menu").animate({width:"0px",minWidth:"0"},150),$("#side_menu").removeClass("leave-toggle").addClass("enter-toggle")):($(".js_nav_menu_toggle").removeClass("enter-toggle").addClass("leave-toggle"),$("#side_menu").animate({width:"220px",minWidth:"220px"},150),$("#side_menu").removeClass("enter-toggle").addClass("leave-toggle")))}var t="",n=!1,i=200;$(window).resize(function(){t=new Date,n===!1&&(n=!0,setTimeout(e,i))})}},{key:"toggle",value:function(){$("#side_menu").hasClass("enter-toggle")?($(".js_nav_menu_toggle").removeClass("enter-toggle").addClass("leave-toggle"),$("#side_menu").animate({width:"220px",minWidth:"220px"},300),$("#side_menu").removeClass("enter-toggle").addClass("leave-toggle")):($(".js_nav_menu_toggle").removeClass("leave-toggle").addClass("enter-toggle"),$("#side_menu").animate({width:"0px",minWidth:"0"},300),$("#side_menu").removeClass("leave-toggle").addClass("enter-toggle"))}},{key:"autoToggleSideMenu",value:function(e){var t=[!1],n=t[0],i=t[1];t[2];e.menuData.some(function(t,a){if(t._child.some(function(t,r){if(e.currentMenu===t.menu_act)return n=!0,i=a,!0}),n)return $(".js_menu_item").removeClass("open-menu"),$(".js_menu_item").eq(i).siblings().find(".js_sub_menu_wrap").hide(),$(".js_menu_item").eq(i).addClass("open-menu").find(".js_sub_menu_wrap").show(),$(".js_menu_item").eq(i).find(".toggle-icon").addClass("glyphicon-menu-down"),$(".js_menu_item").eq(i).siblings().find(".toggle-icon").removeClass("glyphicon-menu-down"),!0})}},{key:"renderMenu",value:function(e){var t={menuData:e,currentMenu:(new v).getCacheView()},i=this;this.menuData=e,this.cacheMenu(e),n("#sideMenuTpl","#js_menu_wrap",t,function(e){i.autoToggleSideMenu(t)})}},{key:"cacheMenu",value:function(e){function t(e){if(e instanceof Array){var t={};return e.forEach(function(e,n){e._child.forEach(function(e,n){t[e.menu_act]=e})}),t}}window.localStorage&&(localStorage["menu-list"]=JSON.stringify(t(e)))}},{key:"init",value:function(){this.sideMenuToggleBind(),this.navMenuToggleBind(),this.autoToggle()}}]),e}(),function(){function n(){m(this,n),this.clearView(),this.initView="listConfig",this.routerConfig=e()}return f(n,[{key:"loadTemplate",value:function(e,t){var n=this;return e=e||this.getCacheView()||this.initView,new Promise(function(i,a){if(n.routerConfig[e]){var r=[n.routerConfig[e].template_url,n],o=r[0],s=r[1];$(".js_view_content").load(o,function(n){s.changeUrl(e,t),s.setCacheView(e),s.viewAnimate(),i(n)})}else c.msg({content:"模板页面未找到，请检查重新配置!",icon:5})})}},{key:"bindRouter",value:function(e){var t=this;$(document).on("click",".js_view_link",function(){$(this).data("view")!=t.getCacheView()&&$(this).data("view")&&(t.go($(this).data("view")),"function"==typeof e&&e($(this).data("view")))})}},{key:"go",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.loadTemplate(e,t)}},{key:"init",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.loadTemplate(e,t)}},{key:"changeUrl",value:function(e,t){var n="",i="",a=location.hash.indexOf("?");a>0&&(i=location.hash.substr(location.hash.indexOf("?"))),t===!1||(t&&o(t)?(n=a>0?"&"+$.param(t):"?"+$.param(t),window.location.href="#"+e+i+n):window.location.href="#"+e)}},{key:"setCacheView",value:function(e){window.localStorage&&(localStorage["active-view"]=e)}},{key:"setRouterParamCache",value:function(e){window.localStorage&&"object"===("undefined"==typeof e?"undefined":l(e))&&(localStorage["param-data"]=JSON.stringify(e))}},{key:"routerParam",value:function(e){var n=t();return e?n[e]:n}},{key:"clearView",value:function(){"/index.html"!=window.location.pathname&&"/"!=window.location.pathname||""!=window.location.hash||localStorage.removeItem("active-view")}},{key:"getCacheView",value:function(){return window.localStorage?localStorage["active-view"]||this.initView:this.initView}},{key:"currentView",value:function(){return this.getCacheView()}},{key:"viewAnimate",value:function(){var e=$(".js_view_content > section");0!=e.length&&e.addClass("view-animated")}}]),n}()),g=function(){function e(t){m(this,e),this.serverUrl="http://servermaster.com/index.php/api/"}return f(e,[{key:"ajax",value:function(e,t){return new Promise(function(n,i){$.ajax({type:e,url:t.url,dataType:"json",data:t.data,timeout:t.timeout||1e4,async:t.async||!0,statusCode:{404:function(e){i(404)}},success:function(e){e.success?n(e):void 0!=e.url&&""!=e.url?location.href=e.url:(i(404),c.msg({content:e.msg,icon:6}))},error:function(e){i(404)}})})}},{key:"getAjax",value:function(e){return this.ajax("get",e)}},{key:"postAjax",value:function(e){return this.ajax("post",e)}},{key:"login",value:function(){return this.getAjax({url:this.serverUrl+"site/info"})}},{key:"loginOut",value:function(){return this.getAjax({url:this.serverUrl+"site/logout"})}},{key:"menuServi",value:function(){var e=this;return{menuList:function(){return e.getAjax({url:e.serverUrl+"menu/list"})},menuAdd:function(t){return e.postAjax({url:e.serverUrl+"menu/add",data:t})},menuAddCsrf:function(t){return e.getAjax({url:e.serverUrl+"menu/add",data:t})},configList:function(){return e.getAjax({url:e.serverUrl+"config/list"})},masterList:function(){return e.getAjax({url:e.serverUrl+"mysql-master/list"})},masterOperateList:function(){return e.getAjax({url:e.serverUrl+"mysql-master-operate/list"})}}}},{key:"configServi",value:function(){var e=this;return{configAdd:function(t){return e.postAjax({url:e.serverUrl+"config/add",data:t})},configAddCsrf:function(t){return e.getAjax({url:e.serverUrl+"config/add",data:t})},modelAdd:function(t){return e.postAjax({url:e.serverUrl+"mode/add",data:t})},modelAddCsrf:function(t){return e.getAjax({url:e.serverUrl+"mode/add",data:t})},modelList:function(t){return e.getAjax({url:e.serverUrl+"mode/list",data:t})},serviceAdd:function(t){return e.postAjax({url:e.serverUrl+"service/add",data:t})},servceAddCsrf:function(t){return e.getAjax({url:e.serverUrl+"service/add",data:t})},serviceList:function(){return e.getAjax({url:e.serverUrl+"service/list"})},applicationAddCsrf:function(t){return e.getAjax({url:e.serverUrl+"application/add",data:t})},applicationAdd:function(t){return e.postAjax({url:e.serverUrl+"application/add",data:t})},applicationList:function(t){return e.getAjax({url:e.serverUrl+"application/list",data:t})},ipBindCsrf:function(t){return e.getAjax({url:e.serverUrl+"config/bind",data:t})},ipBind:function(t){return e.postAjax({url:e.serverUrl+"config/bind",data:t})},masterAdd:function(t){return e.postAjax({url:e.serverUrl+"mysql-master/add",data:t})},masterAddCsrf:function(t){return e.getAjax({url:e.serverUrl+"mysql-master/add",data:t})},changeMaster:function(t){return e.postAjax({url:e.serverUrl+"mysql-master/change",data:t})},changeMasterResult:function(t){return e.getAjax({url:e.serverUrl+"mysql-master/get-result",data:t})}}}},{key:"websiteServi",value:function(){var e=this;return{websiteAdd:function(t){return e.postAjax({url:e.serverUrl+"website/add",data:t})},websiteAddCsrf:function(t){return e.getAjax({url:e.serverUrl+"website/add",data:t})},websiteList:function(t){return e.getAjax({url:e.serverUrl+"website/list",data:t})}}}},{key:"departmentServi",value:function(){var e=this;return{departmentList:function(){return e.postAjax({url:e.serverUrl+"department/list"})},departmentCsrf:function(t){return e.getAjax({url:e.serverUrl+"department/add",data:t})},departmentAdd:function(t){return e.postAjax({url:e.serverUrl+"department/add",data:t})}}}},{key:"adminServi",value:function(){var e=this;return{adminList:function(){return e.getAjax({url:e.serverUrl+"admin/list"})},adminCsrf:function(t){return e.getAjax({url:e.serverUrl+"admin/add",data:t})},adminAdd:function(t){return e.postAjax({url:e.serverUrl+"admin/add",data:t})}}}},{key:"logServi",value:function(){var e=this;return{logList:function(t){return e.getAjax({url:e.serverUrl+"log/list",data:t})}}}}]),e}(),p={services:new g,viewManage:new v,csrf:"",renderMenuData:function(){var e=c.loading();this.services.menuServi().menuList().then(function(t){c.close(e),n("#menuListTpl","#sideMenuListTableTbody",t.data)},function(t){c.close(e),c.msg({content:"数据加载失败,请重试!"})})},renderAdminData:function(){var e=c.loading();this.services.adminServi().adminList().then(function(t){c.close(e),n("#adminTpl","#adminTbody",t.data)},function(t){c.close(e),c.msg({content:"数据加载失败,请重试!"})})},renderDepartmentData:function(){var e=c.loading();this.services.departmentServi().departmentList().then(function(t){c.close(e),n("#departmentTpl","#departmentTbody",t.data)},function(t){c.close(e),c.msg({content:"数据加载失败,请重试!"})})},renderEditorMenu:function(e,t){var n=this,i=c.loading();this.services.menuServi().menuAddCsrf(e).then(function(e){c.close(i),n.csrf=e.data.csrf,s("#menu_mod",e.data.mod_list,"code","name",e.data.menu_info.menu_mod),s("#parent_id",e.data.sel_list,"id","menu_name",e.data.menu_info.parent_id),r("#menu_name",e.data.menu_info.menu_name),r("#menu_ctl",e.data.menu_info.menu_ctl),r("#menu_act",e.data.menu_info.menu_act),r("#template_url",e.data.menu_info.template_url),r("#order_num",e.data.menu_info.order_num),1==e.data.menu_info.is_state?$("#is_state_1").prop("checked",!0):$("#is_state_0").prop("checked",!0),"function"==typeof t&&t(e)},function(e){c.close(i),c.msg({content:"数据加载失败,请重试!"})})},renderEditorDepartment:function(e,t){var i=this;this.services.departmentServi().departmentCsrf(e).then(function(e){i.csrf=e.data.csrf;var a=d(e.data.sel_list,"id");window.checkedPower=e.data.info.powers.split(","),s("#parent_id",e.data.sel_list,"id","de_name",e.data.info.parent_id),n("#powerTpl","#powers_list",e.data.sel_list[e.data.info.parent_id].powers_list),r("#departmentName",e.data.info.de_name),$("#parent_id").on("change",function(){var e=$(this).val();$("#powers_list").html(""),n("#powerTpl","#powers_list",a[e].powers_list),$("#js_department_form").validator("update")}),$("#powers_list").on("click","#power_item_child_all",function(){$("input:checkbox").not(this).prop("checked",this.checked)}),"function"==typeof t&&t()})},renderAddAdmin:function(e){var t=this;this.services.adminServi().adminCsrf().then(function(n){t.csrf=n.data.csrf,s("#department",n.data.department_list,"id","de_name"),"function"==typeof e&&e()})},renderEditorAdmin:function(e,t){var n=this;this.services.adminServi().adminCsrf(e).then(function(e){n.csrf=e.data.csrf,s("#department",e.data.department_list,"id","de_name",e.data.info.department_id),r("#username",e.data.info.username),r("#realname",e.data.info.real_name),1==e.data.info.is_owner?$("#is_owner_1").prop("checked",!0):$("#is_owner_0").prop("checked",!0),"function"==typeof t&&t()})},renderAddDepartment:function(e){var t=this;this.services.departmentServi().departmentCsrf().then(function(i){t.csrf=i.data.csrf,window.checkedPower=[""],s("#parent_id",i.data.sel_list,"id","de_name",i.data.sel_list[0].id),n("#powerTpl","#powers_list",i.data.sel_list[0].powers_list);var a=d(i.data.sel_list,"id");$("#parent_id").on("change",function(){var e=$(this).val();console.log(e,a[e]),$("#powers_list").html(""),n("#powerTpl","#powers_list",a[e].powers_list),$("#js_department_form").validator("update")}),$("#powers_list").on("click","#power_item_child_all",function(){$("input:checkbox").not(this).prop("checked",this.checked)}),"function"==typeof e&&e()})},getAddMenuFormData:function(){var e=this;this.services.menuServi().menuAddCsrf().then(function(t){e.csrf=t.data.csrf,s("#menu_mod",t.data.mod_list,"code","name"),s("#parent_id",t.data.sel_list,"id","menu_name")})},submitMenuData:function(e,t){Object.assign(t,i(e.serializeArray()),{csrf:this.csrf}),e.find("button[type=submit]").button("reset");var n=c.loading({content:"正在保存..."});this.services.menuServi().menuAdd(t).then(function(e){c.msg("菜单保存成功"),setTimeout(function(){c.close(n),p.viewManage.go("sideMenuList").then(function(e){window.location.reload()})},1500)}).catch(function(t){c.close(n),e.find("button[type=submit]").button("reset")})},submitAdminData:function(e,t){var n={};Object.assign(n,i(e.serializeArray()),{csrf:this.csrf},t);var a=c.loading({content:"正在保存..."});this.services.adminServi().adminAdd(n).then(function(e){c.msg("部门信息保存成功"),c.close(a),p.viewManage.go("adminList")}).catch(function(e){c.close(a)})},submitDepartmentData:function(e,t){var n=a("#powers_list");if(0==n.length)return void c.msg("请选择权限");var r={check_all:0};n.indexOf("all")>=0&&(r.check_all=1,n.remove("all"));var o={};r.powers=n,Object.assign(o,i(e.serializeArray()),r,{csrf:this.csrf},t),e.find("button[type=submit]").button("reset");var s=c.loading({content:"正在保存..."});this.services.departmentServi().departmentAdd(o).then(function(e){c.msg("部门信息保存成功"),c.close(s),p.viewManage.go("departmentList")}).catch(function(t){c.close(s),e.find("button[type=submit]").button("reset")})}};$(function(){var e=p.viewManage.currentView();if(e.match(/sideMenuList/gi))p.renderMenuData(),$("#sideMenuListTableTbody").on("click",".js_editor_menu_btn",function(){var e=$(this).data("ids");p.viewManage.go("editorSideMenu",{menuId:e[1]})});else if(e.match(/departmentList/gi))p.renderDepartmentData(),$("#departmentTbody").on("click",".js_editor_department",function(){var e=$(this).data("id");p.viewManage.go("departmentEditor",{departmentId:e})});else if(e.match(/sideMenuAdd/gi))p.getAddMenuFormData(),u("#js_add_menu_form",function(e){var t={csrf:p.csrf};Object.assign(t,i(e.serializeArray())),p.submitMenuData(e,t)});else if(e.match(/editorSideMenu/gi)){var t=p.viewManage.routerParam("menuId");p.renderEditorMenu({id:t},function(e){u("#js_add_menu_form",function(e){var n={id:t};p.submitMenuData(e,n)})})}else if(e.match(/departmentEditor/gi)){var n=p.viewManage.routerParam("departmentId");p.renderEditorDepartment({id:n},function(e){u("#js_department_form",function(e){p.submitDepartmentData(e,{id:n})})})}else if(e.match(/departmentAdd/gi))p.renderAddDepartment(function(e){u("#js_department_form",function(e){p.submitDepartmentData(e)})});else if(e.match(/adminList/gi))p.renderAdminData(),$("#adminTbody").on("click",".js_editor_admin",function(){var e=$(this).data("id");p.viewManage.go("adminEditor",{adminId:e})});else if(e.match(/adminAdd/gi))p.renderAddAdmin(function(e){u("#js_admin_form",function(e){p.submitAdminData(e)})});else if(e.match(/adminEditor/gi)){var a=p.viewManage.routerParam("adminId");p.renderEditorAdmin({id:a},function(e){u("#js_admin_form",function(e){p.submitAdminData(e,{id:a})})})}})});